@startuml
title Auto-generated diagram from flexibility_products_auto.puml
skinparam classAttributeIconSize 0

package "Enums" {
class FlexibilityProduct_serviceStructure_Enum <<enumeration>> {
  Utilisation Only
  Availability and Utilisation
}
class AvailabilityRequirements_acceptanceTiming_Enum <<enumeration>> {
  At Trade
  After Trade
}
class AvailabilityRequirements_availabilityChangesAllowed_Enum <<enumeration>> {
  Yes
  No
}
class AvailabilityRequirements_availabilityPaymentUnit_Enum <<enumeration>> {
  £/MW/h
  £/MWh
  £/h
}
class AvailabilityRequirements_availabilityPeriod_Enum <<enumeration>> {
  Electricity Forward Agreement (EFA) blocks
  Settlement Periods
  Minutes
}
class AvailabilityRequirements_availabilityRequestMechanism_Enum <<enumeration>> {
  Request initiated by DSO
  Request initiated by FSP
}
class AvailabilityRequirements_partialAvailabilityAcceptancePossible_Enum <<enumeration>> {
  Yes
  No
}
class AvailabilityRequirements_timeVariableAvailabilityVolumesAllowed_Enum <<enumeration>> {
  Yes
  No
}
class UtilisationRequirements_deliveryExpectation_Enum <<enumeration>> {
  Continuous
  Peak Delivery
}
class UtilisationRequirements_partialUtilisationInstructionPossible_Enum <<enumeration>> {
  Yes
  No
}
class UtilisationRequirements_paymentsDuringResponseTime_Enum <<enumeration>> {
  Yes
  No
}
class UtilisationRequirements_timeVariableUtilisationVolumesAllowed_Enum <<enumeration>> {
  Yes
  No
}
class UtilisationRequirements_utilisationInstructionTimings_Enum <<enumeration>> {
  At Trade
  Operational
  Real Time
  Day Ahead
  Week Ahead
}
class UtilisationRequirements_utilisationPaymentUnit_Enum <<enumeration>> {
  £/MWh
  £/MW/season
}
class UtilisationRequirements_utilisationPeriod_Enum <<enumeration>> {
  Electricity Forward Agreement (EFA) blocks
  Settlement Periods
  Minutes
}
class UtilisationInstruction_deliveryExpectation_Enum <<enumeration>> {
  Continuous
  Peak Delivery
}
class InstructionAck_status_Enum <<enumeration>> {
  Accepted
  Rejected
  PartiallyAccepted
}
}

class FlexibilityProduct {
  + id : string
  - name : string
  - description : string
  - serviceStructure : FlexibilityProduct_serviceStructure_Enum
  - priceSettingTimescales : string  // When prices are determined (document lists 'At Trade' and 'Operational').
  - availabilityRequirements : AvailabilityRequirements
  - utilisationRequirements : UtilisationRequirements
  - notes : string
}

class FlexibilityProductCreate {
}

class AvailabilityRequirements {
  - acceptanceTiming : AvailabilityRequirements_acceptanceTiming_Enum  // When availability is accepted by the DSO
  - availabilityChangesAllowed : AvailabilityRequirements_availabilityChangesAllowed_Enum
  - availabilityPaymentUnit : AvailabilityRequirements_availabilityPaymentUnit_Enum  // Units used for availability payments (from document)
  - availabilityPeriod : AvailabilityRequirements_availabilityPeriod_Enum
  - availabilityRefinementTiming : string  // Document gives examples (allowed / not allowed / week ahead etc.).
  - availabilityRequestMechanism : AvailabilityRequirements_availabilityRequestMechanism_Enum
  - minimumAggregateUnitSize : string  // Free text (document examples: 'e.g. 50kW, 1MW, N/A').
  - partialAvailabilityAcceptancePossible : AvailabilityRequirements_partialAvailabilityAcceptancePossible_Enum
  - timeVariableAvailabilityVolumesAllowed : AvailabilityRequirements_timeVariableAvailabilityVolumesAllowed_Enum
}

class UtilisationRequirements {
  - deliveryExpectation : UtilisationInstruction_deliveryExpectation_Enum
  - maximumResponseTime : string  // Either minutes (e.g. '2 minutes', '15 minutes') or 'N/A'.
  - minimumUtilisationTime : string  // Document examples: '60 minutes (Hour)', '30 minutes (Half Hour)'.
  - minimumUtilisationVolume : string  // Free text; document uses 'End state: N/A / Interim: differs per DNO'.
  - partialUtilisationInstructionPossible : UtilisationRequirements_partialUtilisationInstructionPossible_Enum
  - paymentsDuringResponseTime : UtilisationRequirements_paymentsDuringResponseTime_Enum
  - timeVariableUtilisationVolumesAllowed : UtilisationRequirements_timeVariableUtilisationVolumesAllowed_Enum
  - utilisationInstructionTimings : UtilisationRequirements_utilisationInstructionTimings_Enum[]
  - utilisationPaymentUnit : UtilisationRequirements_utilisationPaymentUnit_Enum
  - utilisationPeriod : UtilisationRequirements_utilisationPeriod_Enum
}

class AvailabilityDeclaration {
  + productId : string
  - providerId : string
  - availabilityWindowStart : dateTime
  - availabilityWindowEnd : dateTime
  - declaredVolume : string  // Declared availability volume (units as agreed with DSO; doc typically uses kW/MW).
  - timeVariableVolumes : object[]
  - metadata : string  // Free-form metadata for interim/end-state flags (DSO-specific).
}

class AvailabilityResponse {
  + declarationId : string
  - acceptedVolume : string
  - partialAcceptance : boolean
  - acceptanceTimestamp : dateTime
  - notes : string
}

class UtilisationInstruction {
  + productId : string
  + instructionId : string
  - targetStart : dateTime
  - targetEnd : dateTime
  - instructionVolume : string  // Volume to deliver (kW/MW as per product agreement)
  - partialInstruction : boolean
  - responseTimeRequirement : string  // e.g. '2 minutes', '15 minutes', or 'N/A' per product
  - deliveryExpectation : UtilisationInstruction_deliveryExpectation_Enum
  - timeVariableVolumes : object[]
}

class InstructionAck {
  + instructionId : string
  - providerId : string
  - ackTimestamp : dateTime
  - status : InstructionAck_status_Enum
  - notes : string
}

FlexibilityProduct --> AvailabilityRequirements : availabilityRequirements
FlexibilityProduct --> UtilisationRequirements : utilisationRequirements

@enduml